import numpy as np
from matplotlib import pyplot as plt


def general_group_equation(t, x_prev, y_prev, z_prev, dx_prev, dy_prev, dz_prev, h, fx, fy, fz):
    kx = dict()
    ky = dict()
    kz = dict()

    kx[1] = fx(t,  # Cx1
               x_prev,  # Xx1
               y_prev,  # Yx1
               z_prev,  # Zx1
               dx_prev,  # dXx1
               dy_prev,  # dYx1
               dz_prev)  # dZx1

    ky[1] = fy(t,
               x_prev,
               y_prev,
               z_prev,
               dx_prev,
               dz_prev)

    kz[1] = fz(t,
               x_prev,
               y_prev,
               z_prev,
               dx_prev,
               dy_prev)

    kx[2] = fx(t + (2 / 15) * h,
               x_prev + (2 / 15) * h * dx_prev,
               y_prev + (2 / 15) * h * dy_prev,
               z_prev + (2 / 15) * h * dz_prev,
               dx_prev + (2 / 15) * h * kx[1],
               dy_prev + (2 / 15) * h * ky[1],
               dz_prev + (2 / 15) * h * kz[1])

    ky[2] = fy(t + (1 / 5) * h,
               x_prev + (1 / 5) * h * dx_prev + (h ** 2) * (1 / 200) * (kx[1] + 3 * kx[2]),
               y_prev + (1 / 5) * h * dy_prev,
               z_prev + (1 / 5) * h * dz_prev + (1 / 50) * (h ** 2) * kz[1],
               dx_prev + (1 / 20) * h * (kx[1] + 3 * kx[2]),
               dz_prev + (1 / 5) * h * kz[1])

    kz[2] = fz(t + (1 / 5) * h,
               x_prev + (1 / 5) * h * dx_prev + (h ** 2) * (1 / 200) * (kx[1] + 3 * kx[2]),
               y_prev + (1 / 5) * h * dy_prev + (h ** 2) * (1 / 100) * (ky[1] + ky[2]),
               z_prev + (1 / 5) * h * dz_prev + (1 / 50) * (h ** 2) * kz[1],
               dx_prev + (1 / 20) * h * (kx[1] + 3 * kx[2]),
               dy_prev + (1 / 10) * h * (ky[1] + ky[2]))

    kx[3] = fx(t + (1 / 5) * h,
               x_prev + (1 / 5) * h * dx_prev + (h ** 2) * (1 / 200) * (kx[1] + 3 * kx[2]),
               y_prev + (1 / 5) * h * dy_prev + (h ** 2) * (1 / 100) * (ky[1] + ky[2]),
               z_prev + (1 / 5) * h * dz_prev + (1 / 50) * (h ** 2) * kz[1],
               dx_prev + (1 / 20) * h * (kx[1] + 3 * kx[2]),
               dy_prev + (1 / 10) * h * (ky[1] + ky[2]),
               dz_prev + (1 / 10) * h * (kz[1] + kz[2]))

    ky[3] = fy(t + (1 / 5) * h,
               x_prev + (1 / 5) * h * dx_prev + (h ** 2) * (1 / 200) * (kx[1] + 3 * kx[2]),
               y_prev + (1 / 5) * h * dy_prev + (h ** 2) * (1 / 100) * (ky[1] + ky[2]),
               z_prev + (1 / 5) * h * dz_prev + (1 / 100) * (h ** 2) * (kz[1] + kz[2]),
               dx_prev + (1 / 20) * h * (kx[1] + 3 * kx[2]),
               dz_prev + (1 / 10) * h * (kz[1] + kz[2]))

    kz[3] = fz(t + (1 / 3) * h,
               x_prev + (1 / 3) * h * dx_prev + (h ** 2) * (1 / 72) * (kx[1] + 3 * kx[2]),
               y_prev + (1 / 3) * h * dy_prev + (h ** 2) * (1 / 36) * (ky[1] + ky[2]),
               z_prev + (1 / 3) * h * dz_prev + (1 / 54) * (h ** 2) * (kz[1] + 2 * kz[2]),
               dx_prev + (1 / 108) * h * (11 * kx[1] - 15 * kx[2] + 40 * kx[3]),
               dy_prev + (1 / 54) * h * (3 * ky[1] - 5 * ky[2] + 20 * ky[3]))

    kx[4] = fx(t + (1 / 3) * h,
               x_prev + (1 / 3) * h * dx_prev + (h ** 2) * (1 / 72) * (kx[1] + 3 * kx[2]),
               y_prev + (1 / 3) * h * dy_prev + (h ** 2) * (1 / 36) * (ky[1] + ky[2]),
               z_prev + (1 / 3) * h * dz_prev + (1 / 54) * (h ** 2) * (kz[1] + 2 * kz[2]),
               dx_prev + (1 / 108) * h * (11 * kx[1] - 15 * kx[2] + 40 * kx[3]),
               dy_prev + (1 / 54) * h * (3 * ky[1] - 5 * ky[2] + 20 * ky[3]),
               dz_prev + (1 / 18) * h * (kz[1] + 5 * kz[2]))

    ky[4] = fy(t + (3 / 10) * h,
               x_prev + (3 / 10) * h * dx_prev + (h ** 2) * (
                       (177 / 16000) * kx[1] + (123 / 3200) * kx[2] - (3 / 640) * kx[3] + (3 / 16000) * kx[4]),
               y_prev + (3 / 10) * h * dy_prev + (h ** 2) * (
                       (19 / 800) * ky[1] + (61 / 2400) * ky[2] - (1 / 240) * ky[3]),
               z_prev + (3 / 10) * h * dz_prev + (h ** 2) * (
                       (191 / 8000) * kz[1] + (67 / 3200) * kz[2] + (3 / 16000) * kz[3]),
               dx_prev + h * ((69 / 800) * kx[1] - (9 / 160) * kx[2] + (9 / 32) * kx[3] - (9 / 800) * kx[4]),
               dz_prev + h * ((27 / 400) * kz[1] + (39 / 160) * kz[2] - (9 / 800) * kz[3]))

    kz[4] = fz(t + (1 / 4) * h,
               x_prev + (1 / 4) * h * dx_prev + (h ** 2) * (
                       (39 / 5120) * kx[1] + (29 / 1024) * kx[2] - (5 / 1024) * kx[3] + (1 / 5120) * kx[4]),
               y_prev + (1 / 4) * h * dy_prev + (h ** 2) * (
                       (239 / 13824) * ky[1] + (59 / 3072) * ky[2] - (55 / 9216) * ky[3] + (5 / 6912) * ky[4]),
               z_prev + (1 / 4) * h * dz_prev + (h ** 2) * (
                       (161 / 7680) * kz[1] + (31 / 3072) * kz[2] + (1 / 5120) * kz[3]),
               dx_prev + h * ((17 / 256) * kx[1] + (15 / 256) * kx[2] + (35 / 256) * kx[3] - (3 / 256) * kx[4]),
               dy_prev + h * ((49 / 576) * ky[1] + (5 / 128) * ky[2] + (55 / 384) * ky[3] - (5 / 288) * ky[4]))

    kx[5] = fx(t + (2 / 3) * h,
               x_prev + (2 / 3) * h * dx_prev + (h ** 2) * (
                       (3 / 40) * kx[1] - (23 / 72) * kx[2] + (35 / 72) * kx[3] - (7 / 360) * kx[4]),
               y_prev + (2 / 3) * h * dy_prev + (h ** 2) * (
                       (-13 / 324) * ky[1] - (145 / 648) * ky[2] + (343 / 648) * ky[3] - (7 / 162) * ky[4]),
               z_prev + (2 / 3) * h * dz_prev + (h ** 2) * ((-1 / 20) * kz[1] + (7 / 24) * kz[2] - (7 / 360) * kz[3]),
               dx_prev + (1 / 54) * h * (23 * kx[1] - 15 * kx[2] - 35 * kx[3] + 63 * kx[4]),
               dy_prev + h * ((34 / 81) * ky[1] - (5 / 27) * ky[2] - (35 / 27) * ky[3] + (140 / 81) * ky[4]),
               dz_prev + h * ((22 / 45) * kz[1] - (25 / 9) * kz[2] + (7 / 15) * kz[3] + (112 / 45) * kz[4]))

    ky[5] = fy(t + (8 / 11) * h,
               x_prev + (8 / 11) * h * dx_prev + (h ** 2) * (
                       (9894 / 161051) * kx[1] - (1330 / 14641) * kx[2] + (256505 / 1127357) * kx[3] + (
                       32393 / 805255) * kx[4] + (147204 / 5636785) * kx[5]),
               y_prev + (8 / 11) * h * dy_prev + (h ** 2) * (
                       (14350 / 131769) * ky[1] - (7922 / 131769) * ky[2] - (15196 / 131769) * ky[3] + (
                       43616 / 131769) * ky[4]),
               z_prev + (8 / 11) * h * dz_prev + (h ** 2) * (
                       (-34016 / 483153) * kz[1] + (956885 / 483153) * kz[2] + (768413 / 805255) * kz[3] - (
                       2093568 / 805255) * kz[4]),
               dx_prev + h * ((6118 / 73205) * kx[1] + (30 / 1331) * kx[2] + (7250 / 102487) * kx[3] + (26274 / 73205) *
                              kx[4] + (98136 / 512435) * kx[5]),
               dz_prev + h * ((-47852 / 73205) * kz[1] + (195970 / 14641) * kz[2] + (516954 / 73205) * kz[3] - (
                       1395712 / 73205) * kz[4]))

    kz[5] = fz(t + (8 / 11) * h,
               x_prev + (8 / 11) * h * dx_prev + (h ** 2) * (
                       (49431 / 805255) * kx[1] - (1321 / 14641) * kx[2] + (36530 / 161051) * kx[3] + (
                       32474 / 805255) * kx[4] + (4212 / 161051) * kx[5]),
               y_prev + (8 / 11) * h * dy_prev + (h ** 2) * (
                       (60979 / 1581228) * ky[1] - (2668 / 43923) * ky[2] + (61100 / 347391) * ky[3] + (
                       1711840 / 18579429) * ky[4] + (12285 / 659692) * ky[5]),
               z_prev + (8 / 11) * h * dz_prev + (h ** 2) * (
                       (-166432 / 2415765) * kz[1] + (957302 / 483153) * kz[2] + (769574 / 805255) * kz[3] - (
                       419328 / 161051) * kz[4]),
               dx_prev + h * (
                       (1214 / 14641) * kx[1] + (30 / 1331) * kx[2] + (1070 / 14641) * kx[3] + (5226 / 14641) * kx[
                   4] + (2808 / 14641) * kx[5]),
               dy_prev + h * (
                       (329 / 2178) * ky[1] + (20 / 1331) * ky[2] - (40240 / 115797) * ky[3] + (39520 / 51183) * ky[
                   4] + (4095 / 29986) * ky[5]))

    kx[6] = fx(t + (4 / 5) * h,
               x_prev + (4 / 5) * h * dx_prev + (h ** 2) * (
                       (1 / 44) * kx[1] + (9 / 20) * kx[2] - (87 / 220) * kx[3] + (903 / 5500) * kx[4] + (
                       108 / 1375) * kx[5]),
               y_prev + (4 / 5) * h * dy_prev + (h ** 2) * (
                       (193 / 900) * ky[1] + (97 / 300) * ky[2] - (1127 / 1740) * ky[3] + (791 / 2115) * ky[4] + (
                       7623 / 136300) * ky[5]),
               z_prev + (4 / 5) * h * dz_prev + (h ** 2) * (
                       (-51 / 550) * kz[1] + (5851 / 1100) * kz[2] + (16023 / 5500) * kz[3] - (10752 / 1375) * kz[
                   4]),
               dx_prev + h * (
                       (-83 / 125) * kx[1] + (3 / 5) * kx[2] + (9 / 5) * kx[3] - (189 / 125) * kx[4] + (72 / 125) *
                       kx[5]),
               dy_prev + h * ((-71 / 150) * ky[1] + (2 / 5) * ky[2] + (286 / 145) * ky[3] - (1064 / 705) * ky[4] + (
                       27951 / 68150) * ky[5]),
               dz_prev + h * ((-151 / 250) * kz[1] + (22 / 5) * kz[2] - (126 / 1625) * kz[3] - (416 / 125) * kz[4] + (
                       1331 / 3250) * kz[5]))

    ky[6] = fy(t + h,
               x_prev + h * dx_prev + (h ** 2) * (
                       (159 / 3320) * kx[1] + (185 / 664) * kx[2] - (35 / 166) * kx[3] + (211 / 830) * kx[4] + (
                       54 / 415) * kx[5]),
               y_prev + h * dy_prev + (h ** 2) * (
                       (-124 / 747) * ky[1] + (551 / 2988) * ky[2] + (20378 / 21663) * ky[3] - (22624 / 35109) * ky[
                   4] + (83853 / 452516) * ky[5]),
               z_prev + h * dz_prev + (h ** 2) * (
                       (-1819 / 4980) * kz[1] + (8975 / 996) * kz[2] + (3991 / 830) * kz[3] - (5376 / 415) * kz[4]),
               dx_prev + h * ((101 / 1660) * kx[1] - (15 / 332) * kx[2] + (25 / 83) * kx[3] + (87 / 415) * kx[4] + (
                       9 / 415) * kx[5] + (75 / 166) * kx[6]),
               dz_prev + h * (
                       (1601 / 415) * kz[1] - (11255 / 166) * kz[2] - (36555 / 1079) * kz[3] + (40448 / 415) * kz[
                   4] + (14641 / 10790) * kz[5]))

    kz[6] = fz(t + h,
               x_prev + h * dx_prev + (h ** 2) * (
                       (171 / 3560) * kx[1] + (197 / 712) * kx[2] - (130 / 623) * kx[3] + (113 / 445) * kx[4] + (
                       81 / 623) * kx[5]),
               y_prev + h * dy_prev + (h ** 2) * (
                       (7055 / 38448) * ky[1] + (199 / 1068) * ky[2] - (11755 / 23229) * ky[3] + (61400 / 112941) *
                       ky[4] + (179685 / 1940912) * ky[5]),
               z_prev + h * dz_prev + (h ** 2) * (
                       (-983 / 2670) * kz[1] + (2405 / 267) * kz[2] + (2138 / 445) * kz[3] - (1152 / 89) * kz[4]),
               dx_prev + h * ((11 / 178) * kx[1] - (15 / 356) * kx[2] + (365 / 1246) * kx[3] + (3 / 14) * kx[4] + (
                       27 / 1246) * kx[5] + (1125 / 2492) * kx[6]),
               dy_prev + h * (
                       (-1067 / 6408) * ky[1] - (5 / 178) * ky[2] + (11060 / 7743) * ky[3] - (34360 / 37647) * ky[
                   4] + (658845 / 970456) * ky[5]))

    kx[7] = fx(t + h,
               x_prev + h * dx_prev + (h ** 2) * (
                       (57 / 616) * kx[1] - (15 / 56) * kx[2] + (65 / 154) * kx[3] + (123 / 770) * kx[4] + (
                       36 / 385) * kx[5]),
               y_prev + h * dy_prev + (h ** 2) * (
                       (1 / 63) * ky[1] - (17 / 84) * ky[2] + (361 / 1218) * ky[3] + (958 / 2961) * ky[4] + (
                       363 / 5452) * ky[5]),
               z_prev + h * dz_prev + (h ** 2) * (
                       (-61 / 154) * kz[1] + (149 / 22) * kz[2] + (2643 / 770) * kz[3] - (512 / 55) * kz[4]),
               dx_prev + h * (
                       (23 / 28) * kx[1] - (15 / 28) * kx[2] - (80 / 49) * kx[3] + (108 / 49) * kx[4] - (18 / 49) *
                       kx[5] + (25 / 49) * kx[6]),
               dy_prev + h * ((10 / 21) * ky[1] - (5 / 14) * ky[2] - (200 / 203) * ky[3] + (1360 / 987) * ky[4] + (
                       1331 / 2726) * ky[5]),
               dz_prev + h * ((3 / 5) * kz[1] - (45 / 14) * kz[2] + (36 / 455) * kz[3] + (64 / 21) * kz[4] + (
                       1331 / 2730) * kz[5]))

    dx_next = dx_prev + h * (
            (7 / 96) * kx[1] + (125 / 672) * kx[3] + (27 / 112) * kx[4] + (27 / 112) * kx[5] + (125 / 672) * kx[
        6] + (7 / 96) * kx[7])
    x_next = x_prev + h * dx_prev + (h ** 2) * (
            (7 / 96) * kx[1] + (25 / 168) * kx[3] + (9 / 56) * kx[4] + (9 / 112) * kx[5] + (25 / 672) * kx[6])

    dy_next = dy_prev + h * (
            (23 / 288) * ky[1] + (125 / 1392) * ky[3] + (1000 / 2961) * ky[4] + (161051 / 392544) * ky[5] + (
            83 / 1008) * ky[6])
    y_next = y_prev + h * dy_prev + (h ** 2) * (
            (23 / 288) * ky[1] + (25 / 348) * ky[3] + (100 / 423) * ky[4] + (14641 / 130848) * ky[5])

    dz_next = dz_prev + h * (
            (13 / 160) * kz[1] + (81 / 520) * kz[3] + (256 / 945) * kz[4] + (161051 / 393120) * kz[5] + (
            89 / 1080) * kz[6])
    z_next = z_prev + h * dz_prev + (h ** 2) * (
            (13 / 160) * kz[1] + (27 / 260) * kz[3] + (64 / 315) * kz[4] + (14641 / 131040) * kz[5])

    ky[7] = fy(t + h,
               x_next,
               y_next,
               z_next,
               dx_next,
               dz_next)

    kz[7] = fz(t + h,
               x_next,
               y_next,
               z_next,
               dx_next,
               dy_next)

    kx[8] = fx(t + h,
               x_next,
               y_next,
               z_next,
               dx_next,
               dy_next,
               dz_next)

    errx = (h ** 2) * ((-17 / 12672) * kx[1] + (425 / 88704) * kx[3] + (-1 / 704) * kx[4] + (-87 / 4928) * kx[5] + (
            25 / 1152) * kx[6] + (-7 / 1152) * kx[7])
    erry = (h ** 2) * (
            (-67 / 3456) * ky[1] + (195 / 1856) * ky[3] + (-1795 / 17766) * ky[4] + (104665 / 4710528) * ky[5] + (
            -83 / 12096) * ky[6])
    errz = (h ** 2) * (
            (6533 / 21120) * kz[1] + (-975 / 176) * kz[2] + (-63571 / 22880) * kz[3] + (247552 / 31185) * kz[4] + (
            73205 / 943488) * kz[5] + (-89 / 12960) * kz[6])

    errdx = h * ((-1 / 96) * kx[1] + (3 / 56) * kx[4] + (-3 / 16) * kx[5] + (125 / 672) * kx[6] + (7 / 24) * kx[7] - (
            1 / 3) * kx[8])
    errdy = h * ((-1 / 288) * ky[1] + (25 / 1392) * ky[3] + (-50 / 2961) * ky[4] + (1331 / 392544) * ky[5] + (
            83 / 1008) * ky[6] + (-1 / 12) * ky[7])
    errdz = h * ((-1 / 480) * kz[1] + (-9 / 520) * kz[3] + (16 / 945) * kz[4] + (1331 / 393120) * kz[5] + (89 / 1080) *
                 kz[6] + (-1 / 12) * kz[7])

    error = (errx ** 2 + erry ** 2 + errz ** 2 + errdx ** 2 + errdy ** 2 + errdz ** 2) ** (1 / 2)
    # + errdx ** 2 + errdy ** 2 + errdz ** 2
    return x_next, dx_next, y_next, dy_next, z_next, dz_next, error


def combination_1_1(t, x1_prev, x2_prev, dx1_prev, dx2_prev, h, fx1, fx2):
    kx1 = dict()
    kx2 = dict()

    kx1[1] = fx1(t,
                 x1_prev,
                 x2_prev,
                 dx1_prev,
                 dx2_prev)

    kx2[1] = fx2(t,
                 x1_prev,
                 x2_prev,
                 dx1_prev,
                 dx2_prev)

    kx1[2] = fx1(t + (2 / 15) * h,
                 x1_prev + (2 / 15) * h * dx1_prev,
                 x2_prev + (2 / 15) * h * dx2_prev,
                 dx1_prev + (2 / 15) * h * kx1[1],
                 dx2_prev + (2 / 15) * h * kx2[1])

    kx2[2] = fx2(t + (2 / 15) * h,
                 x1_prev + (2 / 15) * h * dx1_prev,
                 x2_prev + (2 / 15) * h * dx2_prev,
                 dx1_prev + (2 / 15) * h * kx1[1],
                 dx2_prev + (2 / 15) * h * kx2[1])

    kx1[3] = fx1(t + (1 / 5) * h,
                 x1_prev + (1 / 5) * h * dx1_prev + (h ** 2) * (1 / 200) * (kx1[1] + 3 * kx1[2]),
                 x2_prev + (1 / 5) * h * dx2_prev + (h ** 2) * (1 / 200) * (kx2[1] + 3 * kx2[2]),
                 dx1_prev + (1 / 20) * h * (kx1[1] + 3 * kx1[2]),
                 dx2_prev + (1 / 20) * h * (kx2[1] + 3 * kx2[2]))

    kx2[3] = fx2(t + (1 / 5) * h,
                 x1_prev + (1 / 5) * h * dx1_prev + (h ** 2) * (1 / 200) * (kx1[1] + 3 * kx1[2]),
                 x2_prev + (1 / 5) * h * dx2_prev + (h ** 2) * (1 / 200) * (kx2[1] + 3 * kx2[2]),
                 dx1_prev + (1 / 20) * h * (kx1[1] + 3 * kx1[2]),
                 dx2_prev + (1 / 20) * h * (kx2[1] + 3 * kx2[2]))

    kx1[4] = fx1(t + (1 / 3) * h,
                 x1_prev + (1 / 3) * h * dx1_prev + (h ** 2) * (1 / 72) * (kx1[1] + 3 * kx1[2]),
                 x2_prev + (1 / 3) * h * dx2_prev + (h ** 2) * (1 / 72) * (kx2[1] + 3 * kx2[2]),
                 dx1_prev + (1 / 108) * h * (11 * kx1[1] - 15 * kx1[2] + 40 * kx1[3]),
                 dx2_prev + (1 / 108) * h * (11 * kx2[1] - 15 * kx2[2] + 40 * kx2[3]))

    kx2[4] = fx2(t + (1 / 3) * h,
                 x1_prev + (1 / 3) * h * dx1_prev + (h ** 2) * (1 / 72) * (kx1[1] + 3 * kx1[2]),
                 x2_prev + (1 / 3) * h * dx2_prev + (h ** 2) * (1 / 72) * (kx2[1] + 3 * kx2[2]),
                 dx1_prev + (1 / 108) * h * (11 * kx1[1] - 15 * kx1[2] + 40 * kx1[3]),
                 dx2_prev + (1 / 108) * h * (11 * kx2[1] - 15 * kx2[2] + 40 * kx2[3]))

    kx1[5] = fx1(t + (2 / 3) * h,
                 x1_prev + (2 / 3) * h * dx1_prev + (h ** 2) * (
                         (3 / 40) * kx1[1] - (23 / 72) * kx1[2] + (35 / 72) * kx1[3] - (7 / 360) * kx1[4]),
                 x2_prev + (2 / 3) * h * dx2_prev + (h ** 2) * (
                         (3 / 40) * kx2[1] - (23 / 72) * kx2[2] + (35 / 72) * kx2[3] - (7 / 360) * kx2[4]),
                 dx1_prev + (1 / 54) * h * (23 * kx1[1] - 15 * kx1[2] - 35 * kx1[3] + 63 * kx1[4]),
                 dx2_prev + (1 / 54) * h * (23 * kx2[1] - 15 * kx2[2] - 35 * kx2[3] + 63 * kx2[4]))

    kx2[5] = fx2(t + (2 / 3) * h,
                 x1_prev + (2 / 3) * h * dx1_prev + (h ** 2) * (
                         (3 / 40) * kx1[1] - (23 / 72) * kx1[2] + (35 / 72) * kx1[3] - (7 / 360) * kx1[4]),
                 x2_prev + (2 / 3) * h * dx2_prev + (h ** 2) * (
                         (3 / 40) * kx2[1] - (23 / 72) * kx2[2] + (35 / 72) * kx2[3] - (7 / 360) * kx2[4]),
                 dx1_prev + (1 / 54) * h * (23 * kx1[1] - 15 * kx1[2] - 35 * kx1[3] + 63 * kx1[4]),
                 dx2_prev + (1 / 54) * h * (23 * kx2[1] - 15 * kx2[2] - 35 * kx2[3] + 63 * kx2[4]))

    kx1[6] = fx1(t + (4 / 5) * h,
                 x1_prev + (4 / 5) * h * dx1_prev + (h ** 2) * (
                         (1 / 44) * kx1[1] + (9 / 20) * kx1[2] - (87 / 220) * kx1[3] + (903 / 5500) * kx1[4] + (
                         108 / 1375) * kx1[5]),
                 x2_prev + (4 / 5) * h * dx2_prev + (h ** 2) * (
                         (1 / 44) * kx2[1] + (9 / 20) * kx2[2] - (87 / 220) * kx2[3] + (903 / 5500) * kx2[4] + (
                         108 / 1375) * kx2[5]),
                 dx1_prev + h * (
                         (-83 / 125) * kx1[1] + (3 / 5) * kx1[2] + (9 / 5) * kx1[3] - (189 / 125) * kx1[4] + (
                         72 / 125) * kx1[5]),
                 dx2_prev + h * (
                         (-83 / 125) * kx2[1] + (3 / 5) * kx2[2] + (9 / 5) * kx2[3] - (189 / 125) * kx2[4] + (
                         72 / 125) * kx2[5]))

    kx2[6] = fx2(t + (4 / 5) * h,
                 x1_prev + (4 / 5) * h * dx1_prev + (h ** 2) * (
                         (1 / 44) * kx1[1] + (9 / 20) * kx1[2] - (87 / 220) * kx1[3] + (903 / 5500) * kx1[4] + (
                         108 / 1375) * kx1[5]),
                 x2_prev + (4 / 5) * h * dx2_prev + (h ** 2) * (
                         (1 / 44) * kx2[1] + (9 / 20) * kx2[2] - (87 / 220) * kx2[3] + (903 / 5500) * kx2[4] + (
                         108 / 1375) * kx2[5]),
                 dx1_prev + h * (
                         (-83 / 125) * kx1[1] + (3 / 5) * kx1[2] + (9 / 5) * kx1[3] - (189 / 125) * kx1[4] + (
                         72 / 125) * kx1[5]),
                 dx2_prev + h * (
                         (-83 / 125) * kx2[1] + (3 / 5) * kx2[2] + (9 / 5) * kx2[3] - (189 / 125) * kx2[4] + (
                         72 / 125) * kx2[5]))

    kx1[7] = fx1(t + h,
                 x1_prev + h * dx1_prev + (h ** 2) * (
                         (57 / 616) * kx1[1] - (15 / 56) * kx1[2] + (65 / 154) * kx1[3] + (123 / 770) * kx1[4] + (
                         36 / 385) * kx1[5]),
                 x2_prev + h * dx2_prev + (h ** 2) * (
                         (57 / 616) * kx2[1] - (15 / 56) * kx2[2] + (65 / 154) * kx2[3] + (123 / 770) * kx2[4] + (
                         36 / 385) * kx2[5]),
                 dx1_prev + h * (
                         (23 / 28) * kx1[1] - (15 / 28) * kx1[2] - (80 / 49) * kx1[3] + (108 / 49) * kx1[4] - (
                         18 / 49) *
                         kx1[5] + (25 / 49) * kx1[6]),
                 dx2_prev + h * (
                         (23 / 28) * kx2[1] - (15 / 28) * kx2[2] - (80 / 49) * kx2[3] + (108 / 49) * kx2[4] - (
                         18 / 49) *
                         kx2[5] + (25 / 49) * kx2[6])
                 )

    kx2[7] = fx2(t + h,
                 x1_prev + h * dx1_prev + (h ** 2) * (
                         (57 / 616) * kx1[1] - (15 / 56) * kx1[2] + (65 / 154) * kx1[3] + (123 / 770) * kx1[4] + (
                         36 / 385) * kx1[5]),
                 x2_prev + h * dx2_prev + (h ** 2) * (
                         (57 / 616) * kx2[1] - (15 / 56) * kx2[2] + (65 / 154) * kx2[3] + (123 / 770) * kx2[4] + (
                         36 / 385) * kx2[5]),
                 dx1_prev + h * (
                         (23 / 28) * kx1[1] - (15 / 28) * kx1[2] - (80 / 49) * kx1[3] + (108 / 49) * kx1[4] - (
                         18 / 49) *
                         kx1[5] + (25 / 49) * kx1[6]),
                 dx2_prev + h * (
                         (23 / 28) * kx2[1] - (15 / 28) * kx2[2] - (80 / 49) * kx2[3] + (108 / 49) * kx2[4] - (
                         18 / 49) *
                         kx2[5] + (25 / 49) * kx2[6])
                 )

    dx1_next = dx1_prev + h * (
            (7 / 96) * kx1[1] + (125 / 672) * kx1[3] + (27 / 112) * kx1[4] + (27 / 112) * kx1[5] +
            (125 / 672) * kx1[6] + (7 / 96) * kx1[7])
    dx2_next = dx2_prev + h * (
            (7 / 96) * kx2[1] + (125 / 672) * kx2[3] + (27 / 112) * kx2[4] + (27 / 112) * kx2[5] +
            (125 / 672) * kx2[6] + (7 / 96) * kx2[7])
    x1_next = x1_prev + h * dx1_prev + (h ** 2) * (
            (7 / 96) * kx1[1] + (25 / 168) * kx1[3] + (9 / 56) * kx1[4] + (9 / 112) * kx1[5] + (25 / 672) * kx1[6])
    x2_next = x2_prev + h * dx2_prev + (h ** 2) * (
            (7 / 96) * kx2[1] + (25 / 168) * kx2[3] + (9 / 56) * kx2[4] + (9 / 112) * kx2[5] + (25 / 672) * kx2[6])

    kx1[8] = fx1(t + h,
                 x1_next,
                 x2_next,
                 dx1_next,
                 dx2_next)

    kx2[8] = fx2(t + h,
                 x1_next,
                 x2_next,
                 dx1_next,
                 dx2_next)

    errx1 = (h ** 2) * ((-17 / 12672) * kx1[1] + (425 / 88704) * kx1[3] + (-1 / 704) * kx1[4] + (-87 / 4928) * kx1[5] +
                        (25 / 1152) * kx1[6] + (-7 / 1152) * kx1[7])
    errx2 = (h ** 2) * ((-17 / 12672) * kx2[1] + (425 / 88704) * kx2[3] + (-1 / 704) * kx2[4] + (-87 / 4928) * kx2[5] +
                        (25 / 1152) * kx2[6] + (-7 / 1152) * kx2[7])

    errdx1 = h * ((-1 / 96) * kx1[1] + (3 / 56) * kx1[4] + (-3 / 16) * kx1[5] + (125 / 672) * kx1[6] + (7 / 24) * kx1[7] - (
            1 / 3) * kx1[8])
    errdx2 = h * ((-1 / 96) * kx2[1] + (3 / 56) * kx2[4] + (-3 / 16) * kx2[5] + (125 / 672) * kx2[6] + (7 / 24) * kx2[7] - (
            1 / 3) * kx2[8])

    error = (errx1 ** 2 + errx2 ** 2 + errdx1 ** 2 + errdx2 ** 2) ** (1 / 2)

    return x1_next, dx1_next, x2_next, dx2_next, error

